const TelegramBot = require('node-telegram-bot-api');
const puppeteer = require('puppeteer');

// BotFather থেকে পাওয়া টোকেন বসাও এখানে
const token = '7779616467:AAHFD9psuEFXBlnbMixNSVJnupnV8MRHaEY';

const bot = new TelegramBot(token, { polling: true });

bot.onText(/\/start/, (msg) => {
  bot.sendMessage(msg.chat.id, 'Welcome! Send me phone numbers separated by commas to check if they are on WhatsApp.');
});

bot.on('message', async (msg) => {
  const chatId = msg.chat.id;
  const text = msg.text;

  if (text.startsWith('/')) return;

  // একাধিক নম্বর আলাদা করো কমা দিয়ে
  const numbers = text.split(',').map(n => n.trim()).filter(n => /^\+?[0-9]{7,15}$/.test(n));

  if (numbers.length === 0) {
    bot.sendMessage(chatId, 'Please send valid phone numbers with country code, separated by commas.');
    return;
  }

  bot.sendMessage(chatId, `Checking ${numbers.length} numbers... Please wait.`);

  // Puppeteer দিয়ে WhatsApp স্ক্যান পেজ ওপেন করা
  const browser = await puppeteer.launch({
    headless: false,
    args: ['--start-maximized'],
    defaultViewport: null
  });

  const page = await browser.newPage();
  await page.goto('https://web.whatsapp.com');

  bot.sendMessage(chatId, 'Please scan the WhatsApp QR code within 1 minute.');
  await page.waitForTimeout(60000); // ১ মিনিট সময় QR স্ক্যান করার জন্য

  // এখানে ডেমো আকারে নম্বরগুলোকে WhatsApp-এ আছে ধরে নিচ্ছি
  for (let number of numbers) {
    bot.sendMessage(chatId, `${number} is on WhatsApp (demo).`);
  }

  await browser.close();
});